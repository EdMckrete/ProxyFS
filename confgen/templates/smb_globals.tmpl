{{/* Declare our global variables.  Need Go 1.11+ */}}
{{$AdIDCommentStr := ""}}
{{$ADDisabledCommentStr := ""}}
{{ if not .SMB.Enabled }}
	{{$AdIDCommentStr = ";"}}
	{{$ADDisabledCommentStr := ";"}}
{{ end }}

[global]

# ----------------------- Network-Related Options -------------------------
{{ if .SMB.WorkGroup }}
	workgroup = {{ .WorkGroup }}
{{ end }}
	server string = Samba Server Version %v
	map to guest = {{ .SMB.MapToGuest }}

	netbios name = {{ .VirtualHostName }}
	server min protocol = {{ .SMB.ServerMinProtocol }}


# --------------------------- Temporary Options -------------------------
# Until we resolve permissions
{{ $ADDisabledCommentStr }}force user = root
	

# --------------------------- Logging Options -----------------------------

	# log files split per-machine:
	log file = /opt/ss/var/log/samba/log.%m
	# maximum size of 50KB per log file, then rotate:
	max log size = 50
{{ if .SMB.AuditLogging }}
	log level = full_audit:1
{{ end }}

# ----------------------- Standalone Server Options ------------------------
	security = {{ .SMB.Security }}
	{{ $ADDisabledCommentStr }}passdb backend = tdbsam:/opt/ss/lib64/samba/passdb.tdb
	restrict anonymous = 2
	rpc_server:lsarpc = {{ .SMB.RPCServerLSARPC }}


# ----------------------- Domain Members Options ------------------------
{{ $ADDisabledCommentStr }}realm = {{ .SMB.Realm }}
{{ $AdIDCommentStr }}winbind nss info = {{ .SMB.IDSchema }}
winbind use default domain = yes
winbind refresh tickets = yes
winbind enum users = yes
winbind enum groups = yes
winbind expand groups = 5
winbind nested groups = yes

{{ $ADDisabledCommentStr }}idmap config *:backend = tdb
{{ $ADDisabledCommentStr }}idmap config *:range = {{ .SMB.IDMapDefaultMin }} - {{ .SMB.IDMapDefaultMax }}

{{ $ADDisabledCommentStr }}idmap config {{ .SMB.WorkGroup }}:backend = {{ .SMB.BackEnd }}
{{ $ADDisabledCommentStr }}idmap config {{ .SMB.WorkGroup }}:default = yes
{{ $ADDisabledCommentStr }}idmap config {{ .SMB.WorkGroup }}:range = {{ .SMB.IDMapWorkgroupMin }} - {{ .SMB.IDMapWorkgroupMax }}

{{ $ADDisabledCommentStr }}template shell = /sbin/nologin
{{ $ADDisabledCommentStr }}domain master = no
{{ $ADDisabledCommentStr }}preferred master = no
	  	 	  
{{ $ADDisabledCommentStr }}kerberos method = secrets and keytab


#----------------------------- Name Resolution -------------------------------

{{ $ADDisabledCommentStr }}wins server =
{{ $ADDisabledCommentStr }}remote announce = {{ .SMB.BrowserAnnounce }}/{{ .SMB.WorkGroup }}

# --------------------------- ProxyFS Options ---------------------------

	proxyfs:PrivateIPAddr = {{ .VirtualIPAddr }}
	proxyfs:TCPPort = {{ .SMB.TCPPort }}
	proxyfs:FastTCPPort = {{ .SMB.FastTCPPort }}
